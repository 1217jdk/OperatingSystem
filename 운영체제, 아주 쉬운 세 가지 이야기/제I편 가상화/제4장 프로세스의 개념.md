# 프로세스

- 일반적으로 `실행 중인 프로그램`으로 정의됨
- 프로세스의 구성 요소를 이해하기 위해서는 하드웨어 상태(machine state)를 이해해야 함
  - 프로그램이 실행되는 동안 하드웨어 상태를 읽거나 갱신하기 때문

## 메모리

- 프로세스의 하드웨어 상태 중 가장 중요한 구성 요소
- 프로세스가 읽고 쓰는 데이터나 명령어가 저장됨
- 프로세스가 접근할 수 있는 메모리를 주소 공간(address space)이라 부름

## 레지스터

- 프로세스의 하드웨어 상태를 구성하는 요소 중 하나
- 많은 명령어들이 레지스터를 직접 읽거나 갱신함
- 레지스터에는 특별한 레지스터들이 존재함
  - 프로그램 카운터: 프로그래매의 어느 명령어가 실행 중인지를 알려줌. 명령어 포인터라고도 불림
  - 스택 포인터, 프레임 포인터: 함수의 변수와 리턴 주소를 저장하는 스택을 관리할 때 사용되는 레지스터

# 프로세스 API

- 자세한 프로세스 API에 대한 것은 다음장에서 다룰 것
- 이번 장에서는 반드시 제공해야하는 일부 기능에 대해 간단히 살펴볼 것

## 생성(Create)

- 새로운 프로세스를 생성할 수 있어야 함
- 현재는 쉘에 명령어를 입력하거나 아이콘을 클릭하는 것으로 실행시킬 수 있음

## 제거(Destroy)

- 프로세스를 강제로 제거할 수 있어야 함
- 대부분의 프로세스는 일을 마치면 자동으로 종료됨
- 일부 종료되지 않는 프로세스는 사용자가 직접 종료할 필요가 있음

## 대기(Wait)

- 다른 프로세스가 종료되길 기다려야 할 때가 있음

## 각종 제어(Miscellaneous Control)

- 프로세스의 일시 정지 및 재개 등의 다양한 제어 기능들이 제공되어야 함

## 상태(Status)

- 프로세스의 상태 정보를 얻기 위한 인터페이스가 제공되어야 함
- 상태 정보에는 프로세스 실행 기간, 프로세스의 현재 상태 등이 포함됨

# 프로세스 생성

- 프로그램 실행을 위해 운영체제는 다음과 동작들을 수행
  1. 디스크에서 프로그램이 저장되어 있는 바이트를 읽어서 프로그램의 코드와 정적 데이터(static data)를 메모리에 탑재(load)
     - 탑재(load): 디스크 상의 프로그램을 찾아 프로세스의 주소 공간으로 읽어들이는 것
     - 초기 운영체제는 프로그램 실행 전에 모든 코드와 데이터를 모두 메모리에 탑재
     - 지금은 프로그램을 실행하면서 필요한 부분만 메모리에 탑재
       - 이를 위해 페이징(paging)과 스와핑(swapping)이라는 개념이 사용됨
  2. 일정량의 메모리를 프로그램의 실행시간 스택 용도로 할당
     - 지역 변수, 함수 인자, 리턴 주소 등을 저장하기 위함
  3. 프로그램의 힙을 위한 메모리 영역 할당
     - 동적으로 할당된 데이터를 저장하기 위함
     - 연결 리스트, 해시 테이블, 트리 등 크기가 가변적인 자료구조가 주로 사용
  4. 입출력과 관계된 초기화 작업을 수행
     - 입출력과 파일 디스크립터에 대해서는 영속성 파트에서 자세히 다룰 예정
  5. 프로그램의 시작 지점(main 함수)에서 프로그램을 시작하고 CPU를 새로 생성된 프로세스에게 넘김

# 프로세스 상태

- 단순하게 분류하면 3가지 상태가 존재
  - 실행(Running): 프로세스가 명령어를 실행하고 있음
  - 준비(Ready): 실행할 준비가 됐지만 운영체제가 다른 작업을 하고 있어서(ex. 다른 프로세스를 실행 중) 대기 중
  - 대기(Blocked): 프로세스가 다른 사건을 기다리는 동안(ex. 입출력) 프로세스의 수행을 중단시키고 다른 프로세스를 실행할 수 있도록 함
- 프로세스의 실행 및 준비 상태의 전환은 스케줄 여부에 따라 결정됨

# 자료 구조

- 운영체제도 일종의 프로그램이므로 다양한 정보를 유지하기 위한 자료구조를 가지고 있음
- 프로세스 상태를 파악하기 위해 준비 상태의 프로세스를 위한 자료구조인 프로세스 리스트가 있음
  - 프로세스 제어 블럭(Process Control Block, PCB)라고도 부름
- 현재 실행 중인 또는 대기 상태인 프로세스를 파악하기 위한 자료구조들도 있음
- 프로세스가 중단되었을 때 해당 프로세스의 레지스터 값을 저장하는 레지스터 문맥(register context)이라는 자료구조가 있음
  - 레지스터 문맥에 있는 레지스터 값들을 복원해서 프로세스 실행을 재개하는데 사용
  - 이런 기법을 문맥 교환(context switch)이라 함

# 요약

- 프로세스는 간단히 말하자면 `실행 중인 프로그램`을 의미
- 프로세스 구현에 필요한 기법, 구현한 프로세스를 스케줄링하는 정책 등이 중요
- 앞으로 이런 여러 방법들을 조합하여 운영체제가 CPU를 가상화하는 방식을 학습할 것

## CPU가 여러 개 존재한다는 환상을 어떻게 제공하는가?

- 간단히 말하면 가상화를 사용한다고 할 수 있음
- 하나의 프로세스를 실행하고, 얼마 후 중단시키고 다른 프로세스를 실행하는 작업을 반복
  - 이런 기법을 시분할(time sharing)이라 부름
  - 시분할을 사용하면 하나의 CPU를 공유하기 때문에 각 프로세스의 성능은 낮아짐
- CPU 가상화를 잘 구현하기 위해서는 저수준의 도구와 고차원적인 지능이 필요
  - 저수준의 도구를 메커니즘이라 부름
    - 메커니즘: 필요한 기능을 구현하는 방법이나 규칙을 의미
  - 운영체제의 지능은 정책(policy) 형태로 표현됨
