# 개요

- 비례 배분(Proportional Share) 혹은 공정 배분(fair share)이라 불리는 스케줄러 유형이 있음
- 반환 시간이나 응답 시간 대신 각 작업에게 CPU의 일정 비율을 보장하는 것이 목적
- 대표적인 예로 추첨 스케줄링(lottery scheduling)이 있음

# 기본 개념

- 프로세스가 받을 자원의 몫을 나타내는 추첨권(티켓)이라는 개념을 사용  
  ex) 추첨권을 A가 75장, B가 25장 가지고 있다면 CPU를 A에 75%, B에 25%만큼 할당함
- 스케줄러가 이 추첨권 중에서 하나를 랜덤하게 뽑아서 해당 추첨권을 가지는 프로세스를 실행하는 방식으로 구현됨
- 랜덤하게 뽑아서 결정하는 것이므로 정확히 추첨권의 개수만큼 CPU를 할당받지는 않지만 장시간 실행될수록 해당 비율에 가까워짐

# 추첨 기법

- 추첨권을 다루는 기법에는 추첨권 화폐(tocket currency), 추첨권 양도(ticket transfer), 추첨권 팽창(ticket inflation)이 있음

## 추첨권 화폐

- 사용자가 할당받은 추첨권을 자신의 화폐 가치로 자유롭게 할당하는 기법
- 자신의 화폐 가치로 할당한 추첨권은 자동적으로 시스템이 할당한 수에 맞게 환산됨
  ```
  예시: 사용자 A, B에게 각각 100장의 추첨권이 할당됨
  - A의 경우
    - A는 두 개의 작업 A1과 A2를 수행
    - A는 자신이 정한 화폐(A추첨권) 1000장을 만들어서 A1에 500장, A2에 500장씩 할당
    -> A1과 A2에 할당된 500장의 A추첨권은 각각 50장의 추첨권으로 환산됨
  - B의 경우
    - B는 하나의 작업 B1을 수행
    - B는 자신이 정한 화폐(B추첨권) 10장을 만들어서 B1에 10장 할당
    -> B1에 할당된 10장의 B추첨권은 100장의 추첨권으로 환산됨
  => 최종적으로 시스템이 인식하는 추첨권의 개수는 A1 50장, A2 50장, B 100장
  ```

## 추첨권 양도

- 양도를 통해 다른 프로세스에게 일시적으로 추첨권을 넘겨줄 수 있음
- 클라이언트/서버 환경에서 유용하게 사용됨
- 클라이언트가 서버에게 어떤 작업을 대신 해달라고 요청하면서 작업이 빨리 완료될 수 있도록 추첨권을 양도
- 작업이 끝나면 해당 추첨권들은 다시 클라이언트에게 돌려줌

## 추첨권 팽창

- 프로세스들이 서로 신뢰하는 환경에서 사용 가능
- 프로세스가 자신이 가지는 추첨권을 일시적으로 늘이거나 줄일 수 있음
- 어떤 프로세스가 자신이 CPU 시간을 많이 필요로 할 때 다른 프로세스와 통신 없이 혼자 추첨권의 수를 늘리는 식으로 사용됨

# 추첨권 배분 방식

- 각 작업에 몇 개의 추첨권을 배분해야 하는가에 대한 문제
- 아직 해결되지 않음
- 사용자에게 추첨권을 주고 직접 작업에 배분하게 하는 방식이 있음

# 결정론적 방법

- 추첨 스케줄링은 정확한 비율을 보장할 수 없다는 문제가 있음
- 결정론적 공정 배분 스케줄러인 보폭 스케줄링(stride scheduling)이 고안됨

## 보폭 스케줄링

- 각 작업은 보폭이라는 값과 pass라는 값을 가지고 있음
- 보폭값은 어떤 큰 수를 각 작업이 가지고 있는 추첨권의 수로 나눈 값
- 각 작업은 작업을 수행할 때마다 pass에 보폭값을 더함
- pass값이 작은 작업부터 수행됨
  ```
  예시: 작업 A, B, C가 각각 100개, 50개, 250개의 추첨권을 가지고 있고 어떤 큰 수를 10000으로 설정
  - A, B, C의 보폭을 계산
    - A의 보폭은 10000 / 100 = 100
    - B의 보폭은 10000 / 50 = 200
    - C의 보폭은 10000 / 250 = 40
  - pass 값은 모두 0에서 시작하고 pass 값이 같기 때문에 처음에는 아무 작업이나 수행 가능
  - A, B, C 순서대로 수행하고 난 뒤의 pass 값은 100, 200, 40
  - C의 pass 값이 가장 작으므로 C를 수행하고 C의 pass 값이 80이 됨
  - 다시 C의 pass 값이 가장 작으므로 C를 수행하고 C의 pass 값이 120이 됨
  - 이제 A의 pass 값이 가장 작으므로 A를 수행하고 A의 pass 값이 200이 됨
  ...
  ```
- 그러나 보폭 스케줄링은 새로운 작업이 들어왔을 때 pass 값을 지정하는데 문제가 있기 때문에 사용되지 않음  
  ex) 새로 들어온 작업의 pass 값을 0으로 지정할 경우 해당 작업이 CPU를 독점하게 됨

# 요약

- 추첨 스케줄링과 보폭 스케줄링에 대해서 간단하게 학습함
- 둘 다 장점이 있는 방식이지만 CPU 스케줄러로서 널리 사용되지는 않음
  - 추첨 스케줄링은 각 프로세스에 추첨권을 얼마나 할당해야 하는지 알기 어려움
  - 보폭 스케줄링은 새로운 작업이 시작될 때의 처리에 취약함
- 반면 MLFQ같은 범용 스케줄러는 이런 문제를 좀 더 직관적으로 해결하기 때문에 널리 사용됨
- 비례 배분 스케줄러는 추첨권 할당량을 비교적 정확하게 결정할 수 있는 환경에서 유용함
